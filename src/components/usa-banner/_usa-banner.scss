@use "sass:list";
@use "sass:map";
@use "../../stylesheets/packages/uswds-core";

$banner-context: "Banner";
$banner-guidance-measure: 3;
$banner-icon-colors: uswds-core.get-link-tokens-from-bg(
  $theme-banner-background-color,
  $theme-banner-link-color,
  $context: $banner-context
);
$banner-icon-color: list.nth($banner-icon-colors, 1);
$banner-icon-hover: list.nth($banner-icon-colors, 2);
$banner-icon-chevron: (
  "name": "expand_more",
  "svg-height": 40,
  "svg-width": 40,
  "height": 2,
  "color": $banner-icon-color,
  "color-variant": "white",
  "color-hover": $banner-icon-hover,
);
$banner-icon-chevron-up: map.merge(
  $banner-icon-chevron,
  (
    "name": "expand_less",
  )
);
$banner-icon-close: (
  "name": "close",
  "svg-height": 40,
  "svg-width": 40,
  "height": 3,
  "color": "blue-60v",
  "color-variant": "white",
  "container-height": uswds-core.$size-touch-target,
  "container-width": uswds-core.$size-touch-target,
);

.usa-banner {
  @include uswds-core.typeset($theme-banner-font-family);
  @include uswds-core.border-box-sizing;
  background-color: uswds-core.color($theme-banner-background-color);

  @include uswds-core.at-media("tablet") {
    font-size: uswds-core.font-size($theme-banner-font-family, "3xs");
    padding-bottom: uswds-core.units(0);
  }

  .usa-accordion {
    @include uswds-core.typeset($theme-banner-font-family);
  }
}

.usa-banner__header,
.usa-banner__content {
  @include uswds-core.set-text-from-bg(
    $theme-banner-background-color,
    $context: $banner-context
  );
}

.usa-banner__content {
  @include uswds-core.grid-container($theme-banner-max-width);
  @include uswds-core.add-responsive-site-margins;
  background-color: uswds-core.color("transparent");
  font-size: uswds-core.font-size($theme-banner-font-family, 4);
  overflow: hidden;
  padding-bottom: uswds-core.units(2);
  padding-left: uswds-core.units($theme-site-margins-mobile-width - 1);
  padding-top: uswds-core.units(0.5);
  width: 100%;

  @include uswds-core.at-media("tablet") {
    @include uswds-core.u-padding-y(3);
  }

  p {
    &:first-child {
      margin: 0;
    }
  }
}

.usa-banner__guidance {
  @include uswds-core.u-display("flex");
  @include uswds-core.u-flex("align-start");
  @include uswds-core.u-measure($banner-guidance-measure);
  padding-top: uswds-core.units(2);

  @include uswds-core.at-media("tablet") {
    padding-top: uswds-core.units(0);
  }
}

.usa-banner__lock-image {
  $lock-h: 64; // unitless height of svg
  $lock-w: 52; // unitless width of svg
  $lock-aspect: $lock-w / $lock-h;
  $icon-height: 1.5ex; // height of the lock icon; use ex for resilience

  height: $icon-height;
  width: $icon-height * $lock-aspect;
  path {
    fill: currentColor;
  }
}

.usa-banner__inner {
  @include uswds-core.add-responsive-site-margins;
  @include uswds-core.grid-container($theme-banner-max-width);
  @include uswds-core.grid-row;
  @include uswds-core.u-flex("align-start");
  padding-right: uswds-core.units(0);

  @include uswds-core.at-media("tablet") {
    @include uswds-core.u-flex("align-center");
  }
}

.usa-banner__header {
  @include uswds-core.u-padding-y(1);
  font-size: uswds-core.font-size($theme-banner-font-family, 1);
  font-weight: uswds-core.font-weight("normal");
  min-height: uswds-core.units(uswds-core.$size-touch-target);
  position: relative;

  @include uswds-core.at-media("tablet") {
    @include uswds-core.u-padding-y(0.5);
    min-height: 0;
  }
}

.usa-banner__header-text {
  @include uswds-core.u-margin-y(0);
  font-size: uswds-core.font-size($theme-banner-font-family, 1);
  line-height: uswds-core.line-height($theme-banner-font-family, 2);
}

.usa-banner__header-action {
  @include uswds-core.place-icon(
    $banner-icon-chevron,
    "after",
    0,
    middle,
    $theme-banner-background-color
  );
  @include uswds-core.set-link-from-bg(
    $theme-banner-background-color,
    $theme-banner-link-color,
    $context: $banner-context
  );

  line-height: uswds-core.line-height($theme-banner-font-family, 2);
  margin-bottom: uswds-core.units(0);
  margin-top: uswds-core.units(2px);
  text-decoration: underline;

  .usa-banner__header--expanded & {
    display: none;
  }

  @include uswds-core.at-media("tablet") {
    display: none;
  }
}

.usa-banner__header-flag {
  @include uswds-core.u-float("left");
  margin-right: uswds-core.units(1);
  width: uswds-core.units(2);

  @include uswds-core.at-media("tablet") {
    margin-right: uswds-core.units(1);
    padding-top: uswds-core.units(0);
  }
}

.usa-banner__header--expanded {
  padding-right: uswds-core.units(uswds-core.$size-touch-target + 1);

  @include uswds-core.at-media("tablet") {
    background-color: transparent;
    display: block;
    font-size: uswds-core.font-size($theme-banner-font-family, 1);
    font-weight: uswds-core.font-weight("normal");
    min-height: uswds-core.units(0);
    padding-right: uswds-core.units(0);
  }

  .usa-banner__inner {
    margin-left: uswds-core.units(0);

    @include uswds-core.at-media("tablet") {
      margin-left: uswds-core.units(auto);
    }
  }

  .usa-banner__header-action {
    display: none;
  }
}

.usa-banner__button {
  @include uswds-core.button-unstyled;
  @include uswds-core.u-pin("left");
  @include uswds-core.u-pin("y");
  @include uswds-core.u-text("primary", underline, baseline);
  @include uswds-core.set-link-from-bg(
    $theme-banner-background-color,
    $theme-banner-link-color,
    $context: $banner-context
  );
  display: block;
  font-size: uswds-core.font-size($theme-banner-font-family, 1);
  height: auto;
  line-height: uswds-core.line-height($theme-banner-font-family, 2);
  padding-top: uswds-core.units(0);
  padding-left: uswds-core.units(0);
  text-decoration: none;
  width: auto;

  @include uswds-core.at-media-max("tablet") {
    width: 100%;
  }

  @include uswds-core.at-media("tablet") {
    @include uswds-core.place-icon(
      $banner-icon-chevron,
      "after",
      "2px",
      middle,
      $theme-banner-background-color
    );
    @include uswds-core.set-link-from-bg(
      $theme-banner-background-color,
      $theme-banner-link-color,
      $context: $banner-context
    );
    @include uswds-core.u-pin("none");
    display: inline;
    margin-left: uswds-core.units(1);
    position: relative;

    &:after {
      position: absolute;
    }

    &:hover {
      // Underline added to inner text instead.
      text-decoration: none;
    }
  }

  &[aria-expanded="false"] {
    background-image: none;
  }

  &[aria-expanded="true"] {
    background-image: none;

    @include uswds-core.at-media-max("tablet") {
      @include uswds-core.place-icon(
        $banner-icon-close,
        "after",
        0,
        middle,
        "base-lighter"
      );

      &:before {
        @include uswds-core.u-pin("y");
        @include uswds-core.u-pin("right");
        background-color: uswds-core.color("base-lighter");
        content: "";
        display: block;
        height: uswds-core.units(uswds-core.$size-touch-target);
        width: uswds-core.units(uswds-core.$size-touch-target);
      }
      &:after {
        @include uswds-core.u-pin("y");
        @include uswds-core.u-pin("right");
      }
    }

    @include uswds-core.at-media("tablet") {
      @include uswds-core.place-icon(
        $banner-icon-chevron-up,
        "after",
        "2px",
        middle,
        $theme-banner-background-color
      );
      height: auto;
      padding: uswds-core.units(0);
      position: relative;

      &:after {
        position: absolute;
      }
    }
  }
}

.usa-banner__button-text {
  @include uswds-core.add-sr-only;
  text-decoration: underline;

  @include uswds-core.at-media("tablet") {
    @include uswds-core.add-no-sr-only;
    display: inline;
  }
}

.usa-banner__icon {
  width: uswds-core.units(5);
}

// [uswds-init.js] Offscreen content while js is loading
.usa-js-loading {
  .usa-banner__content {
    @include uswds-core.add-sr-only;
  }
}
